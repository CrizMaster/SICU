<app-breadcrumb [Data]="BreadcrumbForm"></app-breadcrumb>
<app-title [Data]="tituloForm"></app-title>
<div class="row my-2">
    <div class="col-12 my-2">
        <div class="row">
            <div class="col-12">
                <mat-accordion class="panel-headers-align" multi>
                    <mat-expansion-panel >
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                            <mat-icon>filter_alt</mat-icon>&nbsp;
                            Filtros de búsqueda
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <form [formGroup]="form" (ngSubmit)="buscar()">
                        <div class="row">
                            <div class="col-md-1">
                                &nbsp;           
                            </div>
                            <div class="col-md-2">
                                <mat-form-field class="input-full-width">
                                    <mat-label>Tipo de documento</mat-label>
                                    <mat-select name="tipodocumento"
                                                formControlName="tipodocumento">
                                      <mat-option *ngFor="let td of ListaTipoDocumento" [value]="td.value">
                                        {{td.text}}
                                      </mat-option>
                                    </mat-select>
                                </mat-form-field>            
                            </div>        
                            <div class="col-md-2">
                                <mat-form-field class="input-full-width">
                                    <mat-label>Número del documento</mat-label>
                                    <input matInput formControlName="numerodocumento">
                                </mat-form-field>
                            </div>
                            <div class="col-md-2">
                                <mat-form-field class="input-full-width">
                                    <mat-label>Apellido Paterno</mat-label>
                                    <input matInput formControlName="apellidopaterno" class="text-uppercase">
                                </mat-form-field>            
                            </div>
                            <div class="col-md-2">
                                <mat-form-field class="input-full-width">
                                    <mat-label>Apellido Materno</mat-label>
                                    <input matInput formControlName="apellidomaterno" class="text-uppercase">
                                </mat-form-field>  
                            </div>
                            <div class="col-md-2">
                                <mat-form-field class="input-full-width">
                                    <mat-label>Nombres</mat-label>
                                    <input matInput formControlName="nombres" class="text-uppercase">
                                </mat-form-field>  
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-11 text-end">
                                <button mat-raised-button color="primary" type="submit">
                                    <mat-icon>filter_alt</mat-icon>
                                    Buscar
                                </button>&nbsp;
                                <button mat-raised-button (click)="limpiar()">
                                    <mat-icon>cleaning_services</mat-icon>
                                    Limpiar
                                </button>            
                            </div>
                          </div>
                      </form>
                    </mat-expansion-panel>
                </mat-accordion>                           
            </div>
        </div>        
    </div>
    <div class="col-12">
        <mat-card>         
            <mat-card-header>   
                <div class="row w-100 my-2">
                    <div class="col">
                        <div class="row row-cols-auto mb-2">
                            <div class="col ms-3">
                                <mat-icon class="icon-display">groups</mat-icon>
                            </div>
                            <div class="col mt-1 fw-bolder">
                                Registro del Personal & Usuarios
                            </div>
                        </div>
                    </div>
                    <div class="col text-end">
                        <button mat-mini-fab color="primary" aria-label="Nuevo personal" (click)="Agregar()" matTooltip="Nuevo Personal">
                            <mat-icon >person_add</mat-icon>
                        </button>                     
                    </div>
                </div>       
            </mat-card-header>
            <mat-card-content>
                <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" multiTemplateDataRows>
                    <ng-container matColumnDef="Nro">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Nro.</th>
                        <td mat-cell *matCellDef="let element" class="text-center">{{element.nro}} </td>
                    </ng-container>
            
                    <ng-container matColumnDef="NumeroDoc">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Tipo y Número de Documento</th>
                        <td mat-cell *matCellDef="let element" class="text-left"> {{element.tipoDocumento}} {{element.numeroDocumento}} </td>
                    </ng-container>
        
                    <ng-container matColumnDef="Personal">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Personal </th>
                        <td mat-cell *matCellDef="let elem" class="text-left"> {{elem.nombres}} {{elem.apePaterno}} {{elem.apeMaterno}}</td>
                    </ng-container>
            
                    <ng-container matColumnDef="Cargo">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Cargo </th>
                        <td mat-cell *matCellDef="let element" class="text-left"> {{element.cargo}} </td>
                    </ng-container>
            
                    <ng-container matColumnDef="Celular">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Celular </th>
                        <td mat-cell *matCellDef="let element" class="text-center"> {{element.celular}} </td>
                    </ng-container>
            
                    <ng-container matColumnDef="Correo">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Correo</th>
                        <td mat-cell *matCellDef="let element" class="text-left"> {{element.correo}} </td>
                    </ng-container>

                    <ng-container matColumnDef="Usuario">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Usuario</th>
                        <td mat-cell *matCellDef="let element" class="text-center"> {{element.userName}} </td>
                    </ng-container>
                    
                    <ng-container matColumnDef="Estado">
                        <th mat-header-cell *matHeaderCellDef class="text-center"> Estado</th>
                        <td mat-cell *matCellDef="let element" class="text-center"> 
                            <span class="text-bg-success px-3 py-2 rounded-pill" *ngIf="element.idUsuario > 0"
                            [class.text-bg-success]="!element.bloqueado"
                            [class.text-bg-danger]="element.bloqueado">{{element.bloqueado ? 'Bloqueado' : 'Activo'}}</span>
                        </td>
                    </ng-container>                    
            
        
                    <ng-container matColumnDef="Accion">
                        <th mat-header-cell *matHeaderCellDef class="text-center">
                            Acción
                        </th>
                        <td mat-cell *matCellDef="let element" class="text-center">
                            <button mat-icon-button 
                                [matMenuTriggerFor]="menu">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                            <mat-menu #menu="matMenu" xPosition="before">
                                <button mat-menu-item (click)="EditarPersona(element)">
                                    <mat-icon>edit</mat-icon>
                                    <span>Editar</span>
                                </button>
                                <button mat-menu-item (click)="EliminarPersona(element)">
                                    <mat-icon>delete</mat-icon>
                                    <span>Eliminar</span>
                                </button>
                                <mat-divider></mat-divider>
                                <button mat-menu-item (click)="CrearUsuario(element)"
                                    *ngIf="element.idUsuario == 0">
                                    <mat-icon>account_circle</mat-icon>
                                    <span>Crear Usuario</span>
                                </button>
                                <button mat-menu-item (click)="CambiarPassword(element)"
                                    *ngIf="element.idUsuario > 0 && !element.bloqueado">
                                    <mat-icon>key</mat-icon>
                                    <span>Cambiar Password</span>
                                </button>
                                <button mat-menu-item (click)="BloquearUsuario(element)"
                                    *ngIf="element.idUsuario > 0 && !element.bloqueado">
                                    <mat-icon>lock</mat-icon>
                                    <span>Bloquear Usuario</span>
                                </button>
                                <button mat-menu-item (click)="DesbloquearUsuario(element)"
                                    *ngIf="element.idUsuario > 0 && element.bloqueado">
                                    <mat-icon>lock_open</mat-icon>
                                    <span>Desbloquear Usuario</span>
                                </button>                                
                          </mat-menu>        
                        </td>
                    </ng-container>
                    
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
        
                <div *ngIf="dataSource.filteredData.length == 0" class="text-danger m-2 fst-italic">No se encontraron registros.</div>
           
                <mat-paginator [pageSizeOptions]="[10, 20, 30]"
                showFirstLastButtons
                (page)="pageEvent = $event; pageChanged($event)">
                </mat-paginator>          
            </mat-card-content>
        </mat-card>        
    </div>
</div>

  